<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Community for Farmers</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: "Segoe UI", Tahoma, Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: #333;
    overflow-x: hidden;
  }

  /* Animated background particles */
  .particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
  }

  .particle {
    position: absolute;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    animation: float 20s infinite linear;
  }

  @keyframes float {
    0% {
      transform: translateY(100vh) rotate(0deg);
      opacity: 0;
    }
    10% {
      opacity: 1;
    }
    90% {
      opacity: 1;
    }
    100% {
      transform: translateY(-100px) rotate(360deg);
      opacity: 0;
    }
  }

  header {
    background: rgba(56, 142, 60, 0.95);
    color: white;
    font-size: 2.2em;
    font-weight: bold;
    padding: 25px;
    text-align: center;
    box-shadow: 0px 4px 20px rgba(0,0,0,0.3);
    backdrop-filter: blur(10px);
    position: relative;
    z-index: 10;
    border-bottom: 3px solid #2e7d32;
  }

  #container {
    max-width: 900px;
    margin: 30px auto;
    background: rgba(255, 255, 255, 0.95);
    padding: 35px;
    border-radius: 25px;
    box-shadow: 0px 15px 35px rgba(0,0,0,0.2);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    position: relative;
    z-index: 10;
    animation: slideUp 0.6s ease-out;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  label, select {
    display: block;
    margin: 15px auto;
    font-size: 1.1em;
  }

  select {
    padding: 12px 20px;
    border: 2px solid #388e3c;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.9);
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1em;
    min-width: 200px;
  }

  select:focus {
    outline: none;
    border-color: #2e7d32;
    box-shadow: 0px 0px 15px rgba(56,142,60,0.4);
  }

  .title-container {
    text-align: center;
    margin: 25px 0;
    padding: 20px;
    background: linear-gradient(135deg, rgba(25, 118, 210, 0.1), rgba(56, 142, 60, 0.1));
    border-radius: 15px;
    border: 1px solid rgba(25, 118, 210, 0.2);
  }

  #communityTitle {
    color: #1976d2;
    font-size: 2em;
    margin: 0;
    font-weight: 600;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
  }

  .subtitle {
    color: #666;
    font-size: 1.1em;
    margin-top: 8px;
    font-style: italic;
  }

  /* Voice controls */
  .voice-controls {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin: 20px 0;
    padding: 15px;
    background: rgba(76, 175, 80, 0.1);
    border-radius: 15px;
    border: 1px solid rgba(76, 175, 80, 0.2);
  }

  .voice-btn {
    background: linear-gradient(135deg, #4caf50, #388e3c);
    color: white;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 1.5em;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .voice-btn:hover {
    background: linear-gradient(135deg, #388e3c, #2e7d32);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
  }

  .voice-btn.recording {
    background: linear-gradient(135deg, #f44336, #d32f2f);
    animation: recordingPulse 1s infinite;
  }

  .voice-btn.speaking {
    background: linear-gradient(135deg, #ff9800, #f57c00);
    animation: speakingPulse 0.5s infinite;
  }

  @keyframes recordingPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }

  @keyframes speakingPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  .voice-status {
    text-align: center;
    margin: 10px 0;
    font-size: 0.9em;
    color: #666;
    min-height: 20px;
  }

  .recording-status {
    color: #f44336;
    font-weight: bold;
  }

  .speaking-status {
    color: #ff9800;
    font-weight: bold;
  }

  /* Chat container with enhanced design */
  #communityChat {
    height: 400px;
    overflow-y: auto;
    border: 2px solid #e0e0e0;
    border-radius: 20px;
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    margin-bottom: 20px;
    padding: 20px;
    box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
    position: relative;
  }

  /* Custom scrollbar */
  #communityChat::-webkit-scrollbar {
    width: 8px;
  }

  #communityChat::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }

  #communityChat::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 10px;
  }

  #communityChat::-webkit-scrollbar-thumb:hover {
    background: #555;
  }

  /* Message styles */
  .user-message {
    background: linear-gradient(135deg, #2196f3, #1976d2);
    color: white;
    padding: 12px 18px;
    border-radius: 20px 20px 5px 20px;
    margin: 8px 0;
    margin-left: 20%;
    box-shadow: 0 3px 10px rgba(33, 150, 243, 0.3);
    animation: messageSlideIn 0.3s ease-out;
    position: relative;
  }

  .bot-message {
    background: linear-gradient(135deg, #4caf50, #388e3c);
    color: white;
    padding: 12px 18px;
    border-radius: 20px 20px 20px 5px;
    margin: 8px 0;
    margin-right: 20%;
    box-shadow: 0 3px 10px rgba(76, 175, 80, 0.3);
    animation: messageSlideIn 0.3s ease-out;
    position: relative;
  }

  .message-controls {
    position: absolute;
    top: 50%;
    right: -40px;
    transform: translateY(-50%);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .user-message:hover .message-controls,
  .bot-message:hover .message-controls {
    opacity: 1;
  }

  .speak-btn {
    background: rgba(255, 255, 255, 0.8);
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 12px;
    color: #333;
  }

  .speak-btn:hover {
    background: white;
    transform: scale(1.1);
  }

  @keyframes messageSlideIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Typing indicator */
  .typing-indicator {
    display: none;
    background: #e0e0e0;
    padding: 12px 18px;
    border-radius: 20px;
    margin: 8px 0;
    margin-right: 20%;
    animation: pulse 1.5s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
  }

  .typing-dots {
    display: inline-block;
  }

  .typing-dots span {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #999;
    margin: 0 2px;
    animation: typingDots 1.4s infinite ease-in-out;
  }

  .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
  .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

  @keyframes typingDots {
    0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
    40% { transform: scale(1); opacity: 1; }
  }

  /* Input area */
  .input-container {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    align-items: center;
  }

  #communityInput {
    flex: 1;
    padding: 15px 20px;
    border: 2px solid #e0e0e0;
    border-radius: 25px;
    font-size: 1em;
    outline: none;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }

  #communityInput:focus {
    border-color: #1976d2;
    box-shadow: 0 0 20px rgba(25, 118, 210, 0.3);
    transform: translateY(-2px);
  }

  #sendBtn {
    background: linear-gradient(135deg, #1976d2, #1565c0);
    color: white;
    border: none;
    border-radius: 25px;
    padding: 15px 30px;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(25, 118, 210, 0.3);
    min-width: 100px;
  }

  #sendBtn:hover {
    background: linear-gradient(135deg, #1565c0, #0d47a1);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(25, 118, 210, 0.4);
  }

  #sendBtn:active {
    transform: translateY(0);
  }

  /* Online users indicator */
  .online-users {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px;
    padding: 10px;
    background: rgba(76, 175, 80, 0.1);
    border-radius: 15px;
    border: 1px solid rgba(76, 175, 80, 0.2);
  }

  .online-dot {
    width: 12px;
    height: 12px;
    background: #4caf50;
    border-radius: 50%;
    margin-right: 8px;
    animation: pulse 2s infinite;
  }

  /* Back button */
  #backBtn {
    background: linear-gradient(135deg, #ff9800, #f57c00);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: bold;
    font-size: 1em;
    box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
    display: block;
    margin: 20px auto 0;
  }

  #backBtn:hover {
    background: linear-gradient(135deg, #f57c00, #ef6c00);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
  }

  /* Welcome message */
  .welcome-message {
    text-align: center;
    color: #666;
    font-style: italic;
    margin: 20px 0;
    padding: 15px;
    background: rgba(233, 236, 239, 0.5);
    border-radius: 15px;
    border-left: 4px solid #1976d2;
  }

  /* Voice settings */
  .voice-settings {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 15px 0;
    padding: 10px;
    background: rgba(233, 236, 239, 0.3);
    border-radius: 10px;
    font-size: 0.9em;
  }

  .voice-setting {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .voice-setting input[type="range"] {
    width: 80px;
  }

  /* Home button */
  .home-button {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: linear-gradient(135deg, #4caf50, #388e3c);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 25px;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 8px;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.2);
  }

  .home-button:hover {
    background: linear-gradient(135deg, #388e3c, #2e7d32);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
    border-color: rgba(255, 255, 255, 0.3);
  }

  .home-button:active {
    transform: translateY(0px);
    box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
  }

  .home-icon {
    font-size: 1.2em;
    transition: transform 0.3s ease;
  }

  .home-button:hover .home-icon {
    transform: scale(1.1);
  }

  /* Responsive home button */
  @media (max-width: 768px) {
    .home-button {
      top: 15px;
      left: 15px;
      padding: 10px 16px;
      font-size: 0.9em;
    }
  }

  /* Responsive design */
  @media (max-width: 768px) {
    #container {
      margin: 20px;
      padding: 25px;
    }

    header {
      font-size: 1.8em;
      padding: 20px;
    }

    #communityChat {
      height: 300px;
    }

    .input-container {
      flex-direction: column;
      gap: 10px;
    }

    #communityInput {
      width: 100%;
    }

    #sendBtn {
      width: 100%;
    }

    .user-message, .bot-message {
      margin-left: 5%;
      margin-right: 5%;
    }

    .voice-controls {
      flex-wrap: wrap;
    }

    .voice-settings {
      flex-direction: column;
      gap: 10px;
    }
  }

  /* Add some predefined farmer avatars */
  .message-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 8px;
    vertical-align: middle;
  }

  .farmer-avatar {
    background: linear-gradient(135deg, #4caf50, #388e3c);
    color: white;
    text-align: center;
    line-height: 30px;
    font-size: 14px;
    font-weight: bold;
  }

  .user-avatar {
    background: linear-gradient(135deg, #2196f3, #1976d2);
    color: white;
    text-align: center;
    line-height: 30px;
    font-size: 14px;
    font-weight: bold;
  }

  .voice-wave {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 2px solid rgba(255, 255, 255, 0.3);
    animation: voiceWave 2s infinite;
    opacity: 0;
  }

  .voice-btn.recording .voice-wave {
    opacity: 1;
  }

  @keyframes voiceWave {
    0% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    100% {
      transform: translate(-50%, -50%) scale(1.5);
      opacity: 0;
    }
  }

  .error-message {
    background: rgba(244, 67, 54, 0.1);
    border: 1px solid rgba(244, 67, 54, 0.3);
    color: #c62828;
    padding: 10px;
    border-radius: 8px;
    margin: 10px 0;
    text-align: center;
    font-size: 0.9em;
  }
</style>
</head>
<body>
<div class="particles" id="particles"></div>

<!-- Home Button -->
<a href="index.html" class="home-button" title="Back to Home">
  <span class="home-icon">üè†</span>
  <span class="home-text" id="homeText">Home</span>
</a>

<header id="headerText">üë• Community for Farmers</header>

<div id="container">
  <label id="langLabel">Select Language:</label>
  <select id="languageSelect" onchange="setLanguage()">
    <option value="en">English</option>
    <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
  </select>

  <div class="title-container">
    <h2 id="communityTitle">Community for Farmers Module</h2>
    <p class="subtitle" id="subtitle">Connect, Share, and Learn with Fellow Farmers</p>
  </div>

  <!-- Voice Controls -->
  <div class="voice-controls">
    <button class="voice-btn" id="micBtn" onclick="toggleRecording()" title="Voice Input">
      üé§
      <div class="voice-wave"></div>
    </button>
    <button class="voice-btn" id="speakBtn" onclick="toggleAutoRead()" title="Auto-read messages">
      üîä
    </button>
    <button class="voice-btn" id="stopBtn" onclick="stopSpeaking()" title="Stop speaking">
      ‚èπÔ∏è
    </button>
  </div>

  <div class="voice-status" id="voiceStatus"></div>

  <!-- Voice Settings -->
  <div class="voice-settings">
    <div class="voice-setting">
      <label for="voiceSpeed">Speed:</label>
      <input type="range" id="voiceSpeed" min="0.5" max="2" step="0.1" value="1">
      <span id="speedValue">1x</span>
    </div>
    <div class="voice-setting">
      <label for="voicePitch">Pitch:</label>
      <input type="range" id="voicePitch" min="0.5" max="2" step="0.1" value="1">
      <span id="pitchValue">1x</span>
    </div>
    <div class="voice-setting">
      <label for="voiceVolume">Volume:</label>
      <input type="range" id="voiceVolume" min="0" max="1" step="0.1" value="0.8">
      <span id="volumeValue">80%</span>
    </div>
  </div>

  <div class="online-users">
    <div class="online-dot"></div>
    <span id="onlineText">24 farmers online</span>
  </div>

  <div id="communityChat">
    <div class="welcome-message" id="welcomeMsg">
      Welcome to the Farmers Community! Ask questions, share experiences, and connect with fellow farmers.
    </div>
  </div>

  <div class="typing-indicator" id="typingIndicator">
    <div class="typing-dots">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <span id="typingText">Farmer is typing...</span>
  </div>

  <div class="input-container">
    <input type="text" id="communityInput" placeholder="Ask a question or chat..." onkeypress="handleKeyPress(event)">
    <button id="sendBtn" onclick="sendCommunityMsg()">
      <span id="sendText">Send</span>
    </button>
  </div>

  <button id="backBtn" onclick="window.location.href='index.html'">
    ‚¨Ö <span id="backText">Back to Home</span>
  </button>
</div>

<script>
const translations = {
  en: {
    header: "üë• Community for Farmers",
    langLabel: "Select Language:",
    title: "Community for Farmers Module",
    subtitle: "Connect, Share, and Learn with Fellow Farmers",
    placeholder: "Ask a question or chat...",
    send: "Send",
    back: "Back to Home",
    home: "Home", // Add home translation
    welcome: "Welcome to the Farmers Community! Ask questions, share experiences, and connect with fellow farmers.",
    online: "farmers online",
    typing: "Farmer is typing...",
    voiceStatus: {
      listening: "üé§ Listening... Speak now",
      processing: "üîÑ Processing speech...",
      error: "‚ùå Voice recognition failed. Try again.",
      autoRead: "üîä Auto-read enabled",
      autoReadOff: "üîá Auto-read disabled",
      speaking: "üó£Ô∏è Speaking...",
      noSpeech: "üö´ No speech detected. Try again.",
      notSupported: "‚ùå Speech recognition not supported in this browser"
    },
    replies: [
      "Hello! Great question about farming techniques!",
      "I've been farming for 20 years, here's my experience...",
      "That's a common issue during monsoon season. Try this method...",
      "Organic farming is definitely the way forward!",
      "Weather has been unpredictable lately. We need to adapt our methods.",
      "Technology is helping us farm more efficiently these days.",
      "Crop rotation has really improved my soil quality.",
      "Thanks for sharing! This will help many farmers.",
      "Government schemes are available for such situations.",
      "Water conservation is crucial in today's farming."
    ],
    farmerNames: ["Raju", "Priya", "Kumar", "Meera", "Suresh", "Lakshmi", "Venu", "Asha"]
  },
  ta: {
    header: "üë• ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡Øç ‡Æö‡ÆÆ‡ØÇ‡Æï ‡Æâ‡Æ∞‡Øà‡ÆØ‡Ææ‡Æü‡Æ≤‡Øç",
    langLabel: "‡ÆÆ‡Øä‡Æ¥‡Æø‡ÆØ‡Øà ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç:",
    title: "‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡Øç ‡Æö‡ÆÆ‡ØÇ‡Æï ‡Æâ‡Æ∞‡Øà‡ÆØ‡Ææ‡Æü‡Æ≤‡Øç ‡Æ™‡Æï‡ØÅ‡Æ§‡Æø",
    subtitle: "‡Æö‡Æï ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡ØÅ‡Æü‡Æ©‡Øç ‡Æá‡Æ£‡Øà‡Æ®‡Øç‡Æ§‡ØÅ, ‡Æ™‡Æï‡Æø‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÅ, ‡Æï‡Æ±‡Øç‡Æ±‡ØÅ‡Æï‡Øç‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç",
    placeholder: "‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø ‡Æï‡Øá‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æâ‡Æ∞‡Øà‡ÆØ‡Ææ‡Æü‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç...",
    send: "‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ",
    back: "‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æ§‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡Æµ‡ØÅ‡ÆÆ‡Øç",
    home: "‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ", // Add Tamil home translation
    welcome: "‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡Øç ‡Æö‡ÆÆ‡ØÇ‡Æï‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æµ‡Æ∞‡ØÅ‡Æï! ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡Æï‡Æ≥‡Øç ‡Æï‡Øá‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Æµ‡Æô‡Øç‡Æï‡Æ≥‡Øà‡Æ™‡Øç ‡Æ™‡Æï‡Æø‡Æ∞‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡Æö‡Æï ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡ØÅ‡Æü‡Æ©‡Øç ‡Æá‡Æ£‡Øà‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç.",
    online: "‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡Øç ‡ÆÜ‡Æ©‡Øç‡Æ≤‡Øà‡Æ©‡Æø‡Æ≤‡Øç",
    typing: "‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø ‡Æ§‡Æü‡Øç‡Æü‡Æö‡Øç‡Æö‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡Æï‡Æø‡Æ±‡Ææ‡Æ∞‡Øç...",
    voiceStatus: {
      listening: "üé§ ‡Æï‡Øá‡Æü‡Øç‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Øä‡Æ£‡Øç‡Æü‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ... ‡Æá‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ ‡Æ™‡Øá‡Æö‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç",
      processing: "üîÑ ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øà ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Ææ‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...",
      error: "‚ùå ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡ÆÖ‡Æ±‡Æø‡Æ§‡Æ≤‡Øç ‡Æ§‡Øã‡Æ≤‡Øç‡Æµ‡Æø‡ÆØ‡Æü‡Øà‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ. ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
      autoRead: "üîä ‡Æ§‡Ææ‡Æ©‡Æø‡ÆØ‡Æô‡Øç‡Æï‡Æø ‡Æµ‡Ææ‡Æö‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡Æá‡ÆØ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
      autoReadOff: "üîá ‡Æ§‡Ææ‡Æ©‡Æø‡ÆØ‡Æô‡Øç‡Æï‡Æø ‡Æµ‡Ææ‡Æö‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡ÆÆ‡ØÅ‡Æü‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
      speaking: "üó£Ô∏è ‡Æ™‡Øá‡Æö‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...",
      noSpeech: "üö´ ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æï‡Æ£‡Øç‡Æü‡Æ±‡Æø‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà. ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
      notSupported: "‚ùå ‡Æá‡Æ®‡Øç‡Æ§ ‡Æ™‡Æø‡Æ∞‡Æµ‡ØÅ‡Æö‡Æ∞‡Æø‡Æ≤‡Øç ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡ÆÖ‡Æ±‡Æø‡Æ§‡Æ≤‡Øç ‡ÆÜ‡Æ§‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà"
    },
    replies: [
      "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ ‡Æ®‡ØÅ‡Æü‡Øç‡Æ™‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Æ±‡Øç‡Æ±‡Æø‡ÆØ ‡Æö‡Æø‡Æ±‡Æ®‡Øç‡Æ§ ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø!",
      "‡Æ®‡Ææ‡Æ©‡Øç 20 ‡ÆÜ‡Æ£‡Øç‡Æü‡ØÅ‡Æï‡Æ≥‡Ææ‡Æï ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç, ‡Æá‡Æ§‡Øã ‡Æé‡Æ©‡Øç ‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Æµ‡ÆÆ‡Øç...",
      "‡ÆÆ‡Æ¥‡Øà‡Æï‡Øç‡Æï‡Ææ‡Æ≤‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æá‡Æ§‡ØÅ ‡Æí‡Æ∞‡ØÅ ‡Æ™‡Øä‡Æ§‡ØÅ‡Æµ‡Ææ‡Æ© ‡Æ™‡Æø‡Æ∞‡Æö‡Øç‡Æö‡Æ©‡Øà. ‡Æá‡Æ®‡Øç‡Æ§ ‡ÆÆ‡ØÅ‡Æ±‡Øà‡ÆØ‡Øà ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç...",
      "‡Æá‡ÆØ‡Æ±‡Øç‡Æï‡Øà ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡ÆÆ‡Øç ‡Æ®‡Æø‡Æö‡Øç‡Æö‡ÆØ‡ÆÆ‡Ææ‡Æï ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Øã‡Æï‡Øç‡Æï‡Æø‡Æö‡Øç ‡Æö‡ØÜ‡Æ≤‡Øç‡Æ≤‡ØÅ‡ÆÆ‡Øç ‡Æµ‡Æ¥‡Æø!",
      "‡Æö‡ÆÆ‡ØÄ‡Æ™‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà ‡Æï‡Æ£‡Æø‡Æï‡Øç‡Æï ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡Æ§‡ØÅ. ‡Æ®‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡Æ±‡Øà‡Æï‡Æ≥‡Øà ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Øç‡Æï‡Øä‡Æ≥‡Øç‡Æ≥ ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç.",
      "‡Æ§‡Øä‡Æ¥‡Æø‡Æ≤‡Øç‡Æ®‡ØÅ‡Æü‡Øç‡Æ™‡ÆÆ‡Øç ‡Æá‡Æ©‡Øç‡Æ±‡ØÅ ‡Æ®‡ÆÆ‡Æï‡Øç‡Æï‡ØÅ ‡ÆÆ‡Æø‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Æø‡Æ±‡ÆÆ‡Øà‡ÆØ‡Ææ‡Æï ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡ÆÆ‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ ‡Æâ‡Æ§‡Æµ‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ.",
      "‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡Æö‡ØÅ‡Æ¥‡Æ±‡Øç‡Æö‡Æø ‡Æé‡Æ©‡Øç ‡ÆÆ‡Æ£‡Øç‡Æ£‡Æø‡Æ©‡Øç ‡Æ§‡Æ∞‡Æ§‡Øç‡Æ§‡Øà ‡ÆÆ‡Æø‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Øá‡ÆÆ‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ.",
      "‡Æ™‡Æï‡Æø‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡Æ§‡Æ±‡Øç‡Æï‡ØÅ ‡Æ®‡Æ©‡Øç‡Æ±‡Æø! ‡Æá‡Æ§‡ØÅ ‡Æ™‡Æ≤ ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æâ‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç.",
      "‡Æá‡Æ§‡Øç‡Æ§‡Æï‡Øà‡ÆØ ‡Æö‡ØÇ‡Æ¥‡Øç‡Æ®‡Æø‡Æ≤‡Øà‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡ÆÖ‡Æ∞‡Æö‡Ææ‡Æô‡Øç‡Æï ‡Æ§‡Æø‡Æü‡Øç‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ©.",
      "‡Æá‡Æ©‡Øç‡Æ±‡Øà‡ÆØ ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æ®‡ØÄ‡Æ∞‡Øç ‡Æ™‡Ææ‡Æ§‡ØÅ‡Æï‡Ææ‡Æ™‡Øç‡Æ™‡ØÅ ‡ÆÆ‡Æø‡Æï ‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Æø‡ÆØ‡ÆÆ‡Øç."
    ],
    farmerNames: ["‡Æ∞‡Ææ‡Æú‡ØÅ", "‡Æ™‡Æø‡Æ∞‡Æø‡ÆØ‡Ææ", "‡Æï‡ØÅ‡ÆÆ‡Ææ‡Æ∞‡Øç", "‡ÆÆ‡ØÄ‡Æ∞‡Ææ", "‡Æö‡ØÅ‡Æ∞‡Øá‡Æ∑‡Øç", "‡Æ≤‡Æü‡Øç‡Æö‡ØÅ‡ÆÆ‡Æø", "‡Æµ‡Øá‡Æ£‡ØÅ", "‡ÆÜ‡Æ∑‡Ææ"]
  }
};

let messageCount = 0;
let isRecording = false;
let autoReadEnabled = false;
let recognition = null;
let synthesis = window.speechSynthesis;
let currentUtterance = null;
let voicesLoaded = false;

// Initialize speech recognition
function initSpeechRecognition() {
  try {
    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
    } else if ('SpeechRecognition' in window) {
      recognition = new SpeechRecognition();
    } else {
      console.log('Speech recognition not supported');
      updateVoiceStatus('notSupported');
      return false;
    }

    const lang = document.getElementById("languageSelect").value;
    recognition.lang = lang === 'ta' ? 'ta-IN' : 'en-US';
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onstart = function() {
      console.log('Speech recognition started');
      isRecording = true;
      updateVoiceStatus('listening');
      document.getElementById('micBtn').classList.add('recording');
    };

    recognition.onresult = function(event) {
      console.log('Speech recognition result:', event.results);
      const transcript = event.results[0][0].transcript;
      document.getElementById('communityInput').value = transcript;
      updateVoiceStatus('processing');
      
      setTimeout(() => {
        sendCommunityMsg();
        updateVoiceStatus('');
      }, 500);
    };

    recognition.onerror = function(event) {
      console.error('Speech recognition error:', event.error);
      updateVoiceStatus('error');
      isRecording = false;
      document.getElementById('micBtn').classList.remove('recording');
      
      setTimeout(() => {
        updateVoiceStatus('');
      }, 3000);
    };

    recognition.onend = function() {
      console.log('Speech recognition ended');
      isRecording = false;
      document.getElementById('micBtn').classList.remove('recording');
      
      // Only show no speech detected if we were listening and got no result
      const currentStatus = document.getElementById('voiceStatus').textContent;
      if (currentStatus.includes('Listening') || currentStatus.includes('‡Æï‡Øá‡Æü‡Øç‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Øä‡Æ£‡Øç‡Æü‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ')) {
        updateVoiceStatus('noSpeech');
        setTimeout(() => {
          updateVoiceStatus('');
        }, 3000);
      }
    };

    return true;
  } catch (error) {
    console.error('Error initializing speech recognition:', error);
    updateVoiceStatus('notSupported');
    return false;
  }
}

function toggleRecording() {
  try {
    if (!recognition && !initSpeechRecognition()) {
      const lang = document.getElementById("languageSelect").value;
      alert(translations[lang].voiceStatus.notSupported);
      return;
    }

    if (isRecording) {
      console.log('Stopping recording');
      recognition.stop();
    } else {
      console.log('Starting recording');
      const lang = document.getElementById("languageSelect").value;
      recognition.lang = lang === 'ta' ? 'ta-IN' : 'en-US';
      recognition.start();
    }
  } catch (error) {
    console.error('Error toggling recording:', error);
    updateVoiceStatus('error');
  }
}

function toggleAutoRead() {
  autoReadEnabled = !autoReadEnabled;
  const speakBtn = document.getElementById('speakBtn');
  
  if (autoReadEnabled) {
    speakBtn.classList.add('speaking');
    updateVoiceStatus('autoRead');
  } else {
    speakBtn.classList.remove('speaking');
    updateVoiceStatus('autoReadOff');
    stopSpeaking();
  }
  
  setTimeout(() => {
    if (!synthesis.speaking) {
      updateVoiceStatus('');
    }
  }, 2000);
}

function speakText(text) {
  if (!autoReadEnabled || !text.trim()) return;

  console.log('Speaking text:', text);
  
  // Stop any current speech
  stopSpeaking();

  try {
    const lang = document.getElementById("languageSelect").value;
    const utterance = new SpeechSynthesisUtterance(text);
    
    // Get voice settings
    const speed = parseFloat(document.getElementById('voiceSpeed').value);
    const pitch = parseFloat(document.getElementById('voicePitch').value);
    const volume = parseFloat(document.getElementById('voiceVolume').value);
    
    utterance.rate = speed;
    utterance.pitch = pitch;
    utterance.volume = volume;
    utterance.lang = lang === 'ta' ? 'ta-IN' : 'en-US';

    // Find appropriate voice
    const voices = synthesis.getVoices();
    const voice = voices.find(v => v.lang.startsWith(lang === 'ta' ? 'ta' : 'en'));
    if (voice) utterance.voice = voice;

    utterance.onstart = function() {
      console.log('Speech started');
      updateVoiceStatus('speaking');
      document.getElementById('speakBtn').classList.add('speaking');
    };

    utterance.onend = function() {
      console.log('Speech ended');
      updateVoiceStatus('');
      document.getElementById('speakBtn').classList.remove('speaking');
      currentUtterance = null;
    };

    utterance.onerror = function(event) {
      console.error('Speech error:', event);
      updateVoiceStatus('');
      document.getElementById('speakBtn').classList.remove('speaking');
      currentUtterance = null;
    };

    currentUtterance = utterance;
    synthesis.speak(utterance);
  } catch (error) {
    console.error('Error in speakText:', error);
  }
}

function stopSpeaking() {
  try {
    if (synthesis.speaking) {
      synthesis.cancel();
    }
    currentUtterance = null;
    document.getElementById('speakBtn').classList.remove('speaking');
    updateVoiceStatus('');
  } catch (error) {
    console.error('Error stopping speech:', error);
  }
}

function speakMessage(text) {
  if (!text.trim()) return;
  
  console.log('Speaking message:', text);
  
  stopSpeaking();
  
  try {
    const lang = document.getElementById("languageSelect").value;
    const utterance = new SpeechSynthesisUtterance(text);
    
    const speed = parseFloat(document.getElementById('voiceSpeed').value);
    const pitch = parseFloat(document.getElementById('voicePitch').value);
    const volume = parseFloat(document.getElementById('voiceVolume').value);
    
    utterance.rate = speed;
    utterance.pitch = pitch;
    utterance.volume = volume;
    utterance.lang = lang === 'ta' ? 'ta-IN' : 'en-US';

    const voices = synthesis.getVoices();
    const voice = voices.find(v => v.lang.startsWith(lang === 'ta' ? 'ta' : 'en'));
    if (voice) utterance.voice = voice;

    utterance.onend = function() {
      console.log('Message speech ended');
    };

    utterance.onerror = function(event) {
      console.error('Message speech error:', event);
    };

    synthesis.speak(utterance);
  } catch (error) {
    console.error('Error in speakMessage:', error);
  }
}

function updateVoiceStatus(status) {
  const lang = document.getElementById("languageSelect").value;
  const statusElement = document.getElementById('voiceStatus');
  
  if (status && translations[lang].voiceStatus[status]) {
    statusElement.textContent = translations[lang].voiceStatus[status];
    statusElement.className = 'voice-status ' + (status.includes('error') || status.includes('notSupported') ? 'error' : 
                              status.includes('listening') || status.includes('speaking') ? 'recording-status' : 
                              status.includes('autoRead') ? 'speaking-status' : '');
  } else {
    statusElement.textContent = '';
    statusElement.className = 'voice-status';
  }
}

function setLanguage() {
  const lang = document.getElementById("languageSelect").value;
  const t = translations[lang];
  
  document.getElementById("headerText").innerText = t.header;
  document.getElementById("langLabel").innerText = t.langLabel;
  document.getElementById("communityTitle").innerText = t.title;
  document.getElementById("subtitle").innerText = t.subtitle;
  document.getElementById("communityInput").placeholder = t.placeholder;
  document.getElementById("sendText").innerText = t.send;
  document.getElementById("backText").innerText = t.back;
  document.getElementById("homeText").innerText = t.home; // Add home text translation
  document.getElementById("welcomeMsg").innerText = t.welcome;
  document.getElementById("onlineText").innerText = `${Math.floor(Math.random() * 30) + 15} ${t.online}`;
  document.getElementById("typingText").innerText = t.typing;
  
  // Update speech recognition language
  if (recognition) {
    recognition.lang = lang === 'ta' ? 'ta-IN' : 'en-US';
  }
}

function createParticles() {
  const particlesContainer = document.getElementById('particles');
  
  for (let i = 0; i < 50; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.left = Math.random() * 100 + '%';
    particle.style.animationDelay = Math.random() * 20 + 's';
    particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
    particle.style.width = particle.style.height = Math.random() * 6 + 2 + 'px';
    particlesContainer.appendChild(particle);
  }
}

function addSpeakButton(messageElement, text) {
  const controls = document.createElement('div');
  controls.className = 'message-controls';
  
  const speakBtn = document.createElement('button');
  speakBtn.className = 'speak-btn';
  speakBtn.innerHTML = 'üîä';
  speakBtn.title = 'Read aloud';
  speakBtn.onclick = () => speakMessage(text);
  
  controls.appendChild(speakBtn);
  messageElement.appendChild(controls);
}

function sendCommunityMsg() {
  const lang = document.getElementById("languageSelect").value;
  const input = document.getElementById("communityInput");
  const message = input.value.trim();
  
  if (!message) return;

  const chat = document.getElementById("communityChat");
  const t = translations[lang];
  
  // Add user message
  const userMsg = document.createElement('div');
  userMsg.className = 'user-message';
  userMsg.innerHTML = `<span class="message-avatar user-avatar">You</span>${message}`;
  addSpeakButton(userMsg, message);
  chat.appendChild(userMsg);
  
  // Clear input and scroll
  input.value = "";
  chat.scrollTop = chat.scrollHeight;
  
  // Show typing indicator
  const typingIndicator = document.getElementById("typingIndicator");
  typingIndicator.style.display = "block";
  chat.scrollTop = chat.scrollHeight;
  
  // Simulate response delay
  setTimeout(() => {
    typingIndicator.style.display = "none";
    
    // Add bot response
    const botMsg = document.createElement('div');
    botMsg.className = 'bot-message';
    
    const farmerName = t.farmerNames[Math.floor(Math.random() * t.farmerNames.length)];
    const reply = t.replies[Math.floor(Math.random() * t.replies.length)];
    const fullReply = `${farmerName}: ${reply}`;
    
    botMsg.innerHTML = `<span class="message-avatar farmer-avatar">${farmerName.charAt(0)}</span><strong>${farmerName}:</strong> ${reply}`;
    addSpeakButton(botMsg, fullReply);
    chat.appendChild(botMsg);
    
    chat.scrollTop = chat.scrollHeight;
    messageCount++;
    
    // Auto-read the reply if enabled
    if (autoReadEnabled) {
      setTimeout(() => speakText(fullReply), 500);
    }
    
    // Occasionally add another farmer joining the conversation
    if (messageCount % 3 === 0) {
      setTimeout(() => {
        const secondFarmer = t.farmerNames[Math.floor(Math.random() * t.farmerNames.length)];
        const secondReply = t.replies[Math.floor(Math.random() * t.replies.length)];
        const secondFullReply = `${secondFarmer}: ${secondReply}`;
        
        const secondMsg = document.createElement('div');
        secondMsg.className = 'bot-message';
        secondMsg.innerHTML = `<span class="message-avatar farmer-avatar">${secondFarmer.charAt(0)}</span><strong>${secondFarmer}:</strong> ${secondReply}`;
        addSpeakButton(secondMsg, secondFullReply);
        chat.appendChild(secondMsg);
        
        chat.scrollTop = chat.scrollHeight;
        
        // Auto-read the second reply if enabled
        if (autoReadEnabled) {
          setTimeout(() => speakText(secondFullReply), 500);
        }
      }, 2000);
    }
    
  }, 1500 + Math.random() * 2000);
}

function handleKeyPress(event) {
  if (event.key === 'Enter') {
    sendCommunityMsg();
  }
}

// Update online count periodically
function updateOnlineCount() {
  const lang = document.getElementById("languageSelect").value;
  const t = translations[lang];
  const count = Math.floor(Math.random() * 30) + 15;
  document.getElementById("onlineText").innerText = `${count} ${t.online}`;
}

// Add some sample messages when page loads
function addSampleMessages() {
  const lang = document.getElementById("languageSelect").value;
  const t = translations[lang];
  const chat = document.getElementById("communityChat");
  
  setTimeout(() => {
    const sampleMessages = [
      { farmer: t.farmerNames[0], message: t.replies[0] },
      { farmer: t.farmerNames[1], message: t.replies[1] }
    ];
    
    sampleMessages.forEach((sample, index) => {
      setTimeout(() => {
        const msg = document.createElement('div');
        msg.className = 'bot-message';
        const fullMessage = `${sample.farmer}: ${sample.message}`;
        msg.innerHTML = `<span class="message-avatar farmer-avatar">${sample.farmer.charAt(0)}</span><strong>${sample.farmer}:</strong> ${sample.message}`;
        addSpeakButton(msg, fullMessage);
        chat.appendChild(msg);
        chat.scrollTop = chat.scrollHeight;
      }, index * 3000);
    });
  }, 2000);
}

// Voice settings event listeners
function setupVoiceSettings() {
  const speedSlider = document.getElementById('voiceSpeed');
  const pitchSlider = document.getElementById('voicePitch');
  const volumeSlider = document.getElementById('voiceVolume');
  
  speedSlider.addEventListener('input', function() {
    document.getElementById('speedValue').textContent = this.value + 'x';
  });
  
  pitchSlider.addEventListener('input', function() {
    document.getElementById('pitchValue').textContent = this.value + 'x';
  });
  
  volumeSlider.addEventListener('input', function() {
    document.getElementById('volumeValue').textContent = Math.round(this.value * 100) + '%';
  });
}

// Load voices
function loadVoices() {
  const voices = synthesis.getVoices();
  voicesLoaded = voices.length > 0;
  console.log('Voices loaded:', voices.length);
}

document.addEventListener("DOMContentLoaded", function() {
  console.log('DOM Content Loaded');
  
  createParticles();
  setLanguage();
  addSampleMessages();
  setupVoiceSettings();
  
  // Initialize speech recognition
  setTimeout(() => {
    initSpeechRecognition();
  }, 1000);
  
  // Load voices
  loadVoices();
  if (synthesis.onvoiceschanged !== undefined) {
    synthesis.onvoiceschanged = loadVoices;
  }
  
  // Update online count every 30 seconds
  setInterval(updateOnlineCount, 30000);
  
  // Test voice functionality
  console.log('Speech synthesis supported:', 'speechSynthesis' in window);
  console.log('Speech recognition supported:', 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window);
});

// Add click event listeners to make sure buttons work
document.addEventListener('click', function(event) {
  if (event.target.closest('#micBtn')) {
    event.preventDefault();
    toggleRecording();
  } else if (event.target.closest('#speakBtn')) {
    event.preventDefault();
    toggleAutoRead();
  } else if (event.target.closest('#stopBtn')) {
    event.preventDefault();
    stopSpeaking();
  }
});
</script>
</body>
</html>
