<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Weather Forecasting</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: "Segoe UI", Tahoma, sans-serif;
    margin: 0;
    padding: 0;
    text-align: center;
    color: #333;
    min-height: 100vh;
    transition: all 0.5s ease;
    overflow-x: hidden;
  }

  /* Static default background - no animation until weather is fetched */
  .default {
    background: linear-gradient(135deg, #89f7fe, #66a6ff);
  }

  /* Dynamic backgrounds for different weather conditions - only animate when weather is fetched */
  .sunny {
    background: linear-gradient(135deg, #ff9a56, #ff6b35);
    animation: sunnyAnimation 10s infinite ease-in-out;
  }

  .cloudy {
    background: linear-gradient(135deg, #bdc3c7, #2c3e50);
    animation: cloudyAnimation 8s infinite ease-in-out;
  }

  .rainy {
    background: linear-gradient(135deg, #3a7bd5, #00d2ff);
    animation: rainyAnimation 6s infinite ease-in-out;
  }

  .snowy {
    background: linear-gradient(135deg, #e6f3ff, #4fc3f7);
    animation: snowyAnimation 12s infinite ease-in-out;
  }

  .stormy {
    background: linear-gradient(135deg, #2c3e50, #4a6741);
    animation: stormyAnimation 5s infinite ease-in-out;
  }

  .misty {
    background: linear-gradient(135deg, #bdc3c7, #e8e8e8);
    animation: mistyAnimation 8s infinite ease-in-out;
  }

  @keyframes sunnyAnimation {
    0%, 100% { background: linear-gradient(135deg, #ff9a56, #ff6b35); }
    50% { background: linear-gradient(135deg, #ffd89b, #ff8a50); }
  }

  @keyframes cloudyAnimation {
    0%, 100% { background: linear-gradient(135deg, #bdc3c7, #2c3e50); }
    50% { background: linear-gradient(135deg, #757f9a, #d7dde8); }
  }

  @keyframes rainyAnimation {
    0%, 100% { background: linear-gradient(135deg, #3a7bd5, #00d2ff); }
    50% { background: linear-gradient(135deg, #667eea, #764ba2); }
  }

  @keyframes snowyAnimation {
    0%, 100% { background: linear-gradient(135deg, #e6f3ff, #4fc3f7); }
    50% { background: linear-gradient(135deg, #a8edea, #fed6e3); }
  }

  @keyframes stormyAnimation {
    0%, 100% { background: linear-gradient(135deg, #2c3e50, #4a6741); }
    50% { background: linear-gradient(135deg, #34495e, #5d6d7e); }
  }

  @keyframes mistyAnimation {
    0%, 100% { background: linear-gradient(135deg, #bdc3c7, #e8e8e8); }
    50% { background: linear-gradient(135deg, #d5d8dc, #f8f9fa); }
  }

  /* Floating particles effect */
  .particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
  }

  .particle {
    position: absolute;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    animation: float 15s infinite linear;
  }

  /* Different particle effects for different weather */
  .sunny .particle {
    background: rgba(255, 215, 0, 0.4);
  }

  .rainy .particle {
    background: rgba(173, 216, 230, 0.6);
    border-radius: 0;
    width: 2px !important;
    height: 20px !important;
  }

  .snowy .particle {
    background: rgba(255, 255, 255, 0.8);
  }

  .stormy .particle {
    background: rgba(169, 169, 169, 0.5);
  }

  @keyframes float {
    0% {
      transform: translateY(100vh) rotate(0deg);
      opacity: 0;
    }
    10% {
      opacity: 1;
    }
    90% {
      opacity: 1;
    }
    100% {
      transform: translateY(-100px) rotate(360deg);
      opacity: 0;
    }
  }

  header {
    background: rgba(56, 142, 60, 0.9);
    color: white;
    font-size: 2em;
    font-weight: bold;
    padding: 20px;
    box-shadow: 0px 4px 20px rgba(0,0,0,0.3);
    backdrop-filter: blur(10px);
    position: relative;
    z-index: 10;
  }

  #container {
    margin: 40px auto;
    background: rgba(255, 255, 255, 0.95);
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0px 8px 32px rgba(0,0,0,0.2);
    max-width: 500px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    position: relative;
    z-index: 10;
    transform: translateY(0);
    transition: transform 0.3s ease;
  }

  #container:hover {
    transform: translateY(-5px);
  }

  label, select, input, button {
    display: block;
    margin: 15px auto;
    font-size: 1.1em;
  }

  /* Input container for autocomplete */
  .input-container {
    position: relative;
    width: 85%;
    margin: 15px auto;
  }

  input[type="text"] {
    padding: 15px;
    border: 2px solid #388e3c;
    border-radius: 12px;
    width: 100%;
    outline: none;
    transition: all 0.3s ease;
    font-size: 1em;
    background: rgba(255, 255, 255, 0.9);
  }

  input[type="text"]:focus {
    border-color: #2e7d32;
    box-shadow: 0px 0px 20px rgba(56,142,60,0.5);
    transform: scale(1.02);
  }

  /* Autocomplete dropdown */
  .autocomplete-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 2px solid #388e3c;
    border-top: none;
    border-radius: 0 0 12px 12px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 1000;
    display: none;
  }

  .autocomplete-item {
    padding: 12px 15px;
    cursor: pointer;
    border-bottom: 1px solid #e0e0e0;
    transition: background-color 0.2s;
  }

  .autocomplete-item:hover {
    background-color: #f0f8f0;
  }

  .autocomplete-item:last-child {
    border-bottom: none;
  }

  select {
    padding: 12px;
    border: 2px solid #388e3c;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.9);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  button {
    background: linear-gradient(135deg, #388e3c, #2e7d32);
    color: white;
    border: none;
    padding: 15px 25px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: bold;
    box-shadow: 0px 4px 15px rgba(56,142,60,0.3);
  }

  button:hover {
    background: linear-gradient(135deg, #2e7d32, #1b5e20);
    transform: translateY(-2px);
    box-shadow: 0px 6px 20px rgba(56,142,60,0.4);
  }

  #weatherResult {
    margin-top: 25px;
    font-size: 1.2em;
    color: #444;
  }

  .weather-card {
    background: linear-gradient(135deg, rgba(241, 248, 246, 0.95), rgba(232, 245, 233, 0.95));
    border-radius: 20px;
    padding: 25px;
    margin-top: 20px;
    box-shadow: 0px 8px 25px rgba(0,0,0,0.15);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    animation: cardAppear 0.5s ease-out;
  }

  @keyframes cardAppear {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .weather-icon {
    font-size: 4em;
    margin: 10px 0;
    animation: bounce 2s infinite ease-in-out;
  }

  @keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
      transform: translateY(0);
    }
    40% {
      transform: translateY(-10px);
    }
    60% {
      transform: translateY(-5px);
    }
  }

  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #388e3c;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .temperature {
    font-size: 2.5em;
    font-weight: bold;
    color: #2e7d32;
    margin: 15px 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
  }

  .weather-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-top: 20px;
  }

  .detail-item {
    background: rgba(255, 255, 255, 0.6);
    padding: 10px;
    border-radius: 10px;
    backdrop-filter: blur(5px);
  }

  .api-note {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
    color: #2e7d32;
    padding: 10px;
    border-radius: 8px;
    margin-top: 10px;
    font-size: 0.9em;
  }

  .error-note {
    background: rgba(244, 67, 54, 0.1);
    border: 1px solid rgba(244, 67, 54, 0.3);
    color: #c62828;
    padding: 10px;
    border-radius: 8px;
    margin-top: 10px;
    font-size: 0.9em;
  }
</style>
</head>
<body class="default">
<div class="particles" id="particles"></div>

<header id="headerText">üå¶Ô∏è AI Weather Forecasting</header>

<div id="container">
    <label id="langLabel">Select Language:</label>
    <select id="languageSelect" onchange="setLanguage()">
        <option value="en">English</option>
        <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
    </select>

    <h2 id="weatherTitle">AI Weather Forecasting Module</h2>
    <p id="weatherDesc">Get the latest weather forecast for your location using AI-powered data.</p>

    <div class="input-container">
        <input type="text" id="locationInput" placeholder="Enter your city or village..." oninput="handleLocationInput()" onkeydown="handleKeyDown(event)">
        <div class="autocomplete-dropdown" id="autocompleteDropdown"></div>
    </div>
    <button id="getWeatherBtn" onclick="getWeather()">Get Forecast</button>

    <div id="weatherResult"></div>
    <br>
    <button id="backBtn" onclick="window.location.href='index.html'">‚¨Ö Back to Home</button>
</div>

<script>
const translations = {
  en: {
    header: "üå¶Ô∏è AI Weather Forecasting",
    langLabel: "Select Language:",
    title: "AI Weather Forecasting Module",
    desc: "Get the latest weather forecast for your location using AI-powered data.",
    placeholder: "Enter your city or village...",
    getWeather: "Get Forecast",
    back: "‚¨Ö Back to Home",
    error: "Could not fetch weather. Please try again.",
    result: city => `Weather for ${city}:`,
    invalidLocation: "Please enter a valid city name (not weather conditions like 'rain', 'sunny', etc.)"
  },
  ta: {
    header: "üå¶Ô∏è ‡Æè.‡Æê. ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Æ±‡Æø‡Æµ‡ØÅ",
    langLabel: "‡ÆÆ‡Øä‡Æ¥‡Æø‡ÆØ‡Øà ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç:",
    title: "‡Æè.‡Æê. ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Æ±‡Æø‡Æµ‡ØÅ ‡Æ™‡Æï‡ØÅ‡Æ§‡Æø",
    desc: "AI ‡ÆÆ‡ØÇ‡Æ≤‡ÆÆ‡Øç ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æü‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡ØÅ ‡Æö‡ÆÆ‡ØÄ‡Æ™‡Æ§‡Øç‡Æ§‡Æø‡ÆØ ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡Æ±‡Æø‡Æµ‡Øà ‡Æ™‡ØÜ‡Æ±‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç.",
    placeholder: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ®‡Æï‡Æ∞‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æï‡Æø‡Æ∞‡Ææ‡ÆÆ‡ÆÆ‡Øç...",
    getWeather: "‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà ‡Æ™‡ØÜ‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç",
    back: "‚¨Ö ‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æ§‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡Æµ‡ØÅ‡ÆÆ‡Øç",
    error: "‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà ‡Æ™‡ØÜ‡Æ± ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà. ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
    result: city => `${city}‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà:`,
    invalidLocation: "‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© ‡Æ®‡Æï‡Æ∞ ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç ('‡ÆÆ‡Æ¥‡Øà', '‡Æµ‡ØÜ‡ÆØ‡Æø‡Æ≤‡Øç' ‡Æ™‡Øã‡Æ©‡Øç‡Æ± ‡Æµ‡Ææ‡Æ©‡Æø‡Æ≤‡Øà ‡Æ®‡Æø‡Æ≤‡Øà‡ÆÆ‡Øà‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤)"
  }
};

let selectedLocationData = null;
let autocompleteTimeout = null;

// Comprehensive cities database with more cities
const worldCities = [
  // Indian Cities
  { name: "Chennai", country: "India", state: "Tamil Nadu", lat: 13.0827, lon: 80.2707 },
  { name: "Mumbai", country: "India", state: "Maharashtra", lat: 19.0760, lon: 72.8777 },
  { name: "Delhi", country: "India", state: "Delhi", lat: 28.7041, lon: 77.1025 },
  { name: "Bangalore", country: "India", state: "Karnataka", lat: 12.9716, lon: 77.5946 },
  { name: "Kolkata", country: "India", state: "West Bengal", lat: 22.5726, lon: 88.3639 },
  { name: "Hyderabad", country: "India", state: "Telangana", lat: 17.3850, lon: 78.4867 },
  { name: "Pune", country: "India", state: "Maharashtra", lat: 18.5204, lon: 73.8567 },
  { name: "Ahmedabad", country: "India", state: "Gujarat", lat: 23.0225, lon: 72.5714 },
  { name: "Jaipur", country: "India", state: "Rajasthan", lat: 26.9124, lon: 75.7873 },
  { name: "Lucknow", country: "India", state: "Uttar Pradesh", lat: 26.8467, lon: 80.9462 },
  { name: "Kanpur", country: "India", state: "Uttar Pradesh", lat: 26.4499, lon: 80.3319 },
  { name: "Nagpur", country: "India", state: "Maharashtra", lat: 21.1458, lon: 79.0882 },
  { name: "Indore", country: "India", state: "Madhya Pradesh", lat: 22.7196, lon: 75.8577 },
  { name: "Bhopal", country: "India", state: "Madhya Pradesh", lat: 23.2599, lon: 77.4126 },
  { name: "Visakhapatnam", country: "India", state: "Andhra Pradesh", lat: 17.6868, lon: 83.2185 },
  { name: "Patna", country: "India", state: "Bihar", lat: 25.5941, lon: 85.1376 },
  { name: "Vadodara", country: "India", state: "Gujarat", lat: 22.3072, lon: 73.1812 },
  { name: "Coimbatore", country: "India", state: "Tamil Nadu", lat: 11.0168, lon: 76.9558 },
  { name: "Ludhiana", country: "India", state: "Punjab", lat: 30.9010, lon: 75.8573 },
  { name: "Agra", country: "India", state: "Uttar Pradesh", lat: 27.1767, lon: 78.0081 },
  { name: "Madurai", country: "India", state: "Tamil Nadu", lat: 9.9252, lon: 78.1198 },
  { name: "Nashik", country: "India", state: "Maharashtra", lat: 19.9975, lon: 73.7898 },
  { name: "Faridabad", country: "India", state: "Haryana", lat: 28.4089, lon: 77.3178 },
  { name: "Meerut", country: "India", state: "Uttar Pradesh", lat: 28.9845, lon: 77.7064 },
  { name: "Rajkot", country: "India", state: "Gujarat", lat: 22.3039, lon: 70.8022 },
  { name: "Kalyan", country: "India", state: "Maharashtra", lat: 19.2403, lon: 73.1305 },
  { name: "Vasai", country: "India", state: "Maharashtra", lat: 19.4883, lon: 72.8058 },
  { name: "Varanasi", country: "India", state: "Uttar Pradesh", lat: 25.3176, lon: 82.9739 },
  { name: "Srinagar", country: "India", state: "Jammu and Kashmir", lat: 34.0837, lon: 74.7973 },
  { name: "Aurangabad", country: "India", state: "Maharashtra", lat: 19.8762, lon: 75.3433 },
  { name: "Dhanbad", country: "India", state: "Jharkhand", lat: 23.7957, lon: 86.4304 },
  { name: "Amritsar", country: "India", state: "Punjab", lat: 31.6340, lon: 74.8723 },
  { name: "Navi Mumbai", country: "India", state: "Maharashtra", lat: 19.0330, lon: 73.0297 },
  { name: "Allahabad", country: "India", state: "Uttar Pradesh", lat: 25.4358, lon: 81.8463 },
  { name: "Ranchi", country: "India", state: "Jharkhand", lat: 23.3441, lon: 85.3096 },
  { name: "Howrah", country: "India", state: "West Bengal", lat: 22.5958, lon: 88.2636 },
  { name: "Jabalpur", country: "India", state: "Madhya Pradesh", lat: 23.1815, lon: 79.9864 },
  { name: "Gwalior", country: "India", state: "Madhya Pradesh", lat: 26.2183, lon: 78.1828 },
  { name: "Vijayawada", country: "India", state: "Andhra Pradesh", lat: 16.5062, lon: 80.6480 },
  { name: "Jodhpur", country: "India", state: "Rajasthan", lat: 26.2389, lon: 73.0243 },
  { name: "Raipur", country: "India", state: "Chhattisgarh", lat: 21.2514, lon: 81.6296 },
  { name: "Kota", country: "India", state: "Rajasthan", lat: 25.2138, lon: 75.8648 },
  { name: "Guwahati", country: "India", state: "Assam", lat: 26.1445, lon: 91.7362 },
  { name: "Chandigarh", country: "India", state: "Chandigarh", lat: 30.7333, lon: 76.7794 },
  { name: "Thiruvananthapuram", country: "India", state: "Kerala", lat: 8.5241, lon: 76.9366 },
  { name: "Solapur", country: "India", state: "Maharashtra", lat: 17.6599, lon: 75.9064 },
  { name: "Hugli", country: "India", state: "West Bengal", lat: 22.9089, lon: 88.3967 },
  { name: "Tiruchirappalli", country: "India", state: "Tamil Nadu", lat: 10.7905, lon: 78.7047 },
  { name: "Salem", country: "India", state: "Tamil Nadu", lat: 11.664, lon: 78.146 },
  { name: "Mira", country: "India", state: "Maharashtra", lat: 19.2952, lon: 72.8694 },
  { name: "Bhiwandi", country: "India", state: "Maharashtra", lat: 19.3002, lon: 73.0630 },
  { name: "Saharanpur", country: "India", state: "Uttar Pradesh", lat: 29.9680, lon: 77.5552 },
  { name: "Gorakhpur", country: "India", state: "Uttar Pradesh", lat: 26.7606, lon: 83.3732 },
  
  // International Cities
  { name: "London", country: "United Kingdom", state: "", lat: 51.5074, lon: -0.1278 },
  { name: "New York", country: "United States", state: "New York", lat: 40.7128, lon: -74.0060 },
  { name: "Tokyo", country: "Japan", state: "", lat: 35.6762, lon: 139.6503 },
  { name: "Paris", country: "France", state: "", lat: 48.8566, lon: 2.3522 },
  { name: "Sydney", country: "Australia", state: "New South Wales", lat: -33.8688, lon: 151.2093 },
  { name: "Los Angeles", country: "United States", state: "California", lat: 34.0522, lon: -118.2437 },
  { name: "Chicago", country: "United States", state: "Illinois", lat: 41.8781, lon: -87.6298 },
  { name: "Toronto", country: "Canada", state: "Ontario", lat: 43.6532, lon: -79.3832 },
  { name: "Berlin", country: "Germany", state: "", lat: 52.5200, lon: 13.4050 },
  { name: "Moscow", country: "Russia", state: "", lat: 55.7558, lon: 37.6173 },
  { name: "Beijing", country: "China", state: "", lat: 39.9042, lon: 116.4074 },
  { name: "Shanghai", country: "China", state: "", lat: 31.2304, lon: 121.4737 },
  { name: "Dubai", country: "United Arab Emirates", state: "", lat: 25.2048, lon: 55.2708 },
  { name: "Singapore", country: "Singapore", state: "", lat: 1.3521, lon: 103.8198 },
  { name: "Hong Kong", country: "Hong Kong", state: "", lat: 22.3193, lon: 114.1694 },
  { name: "Bangkok", country: "Thailand", state: "", lat: 13.7563, lon: 100.5018 },
  { name: "Jakarta", country: "Indonesia", state: "", lat: -6.2088, lon: 106.8456 },
  { name: "Manila", country: "Philippines", state: "", lat: 14.5995, lon: 120.9842 },
  { name: "Seoul", country: "South Korea", state: "", lat: 37.5665, lon: 126.9780 },
  { name: "Istanbul", country: "Turkey", state: "", lat: 41.0082, lon: 28.9784 }
];

function setLanguage() {
  const lang = document.getElementById("languageSelect").value;
  document.getElementById("headerText").innerText = translations[lang].header;
  document.getElementById("langLabel").innerText = translations[lang].langLabel;
  document.getElementById("weatherTitle").innerText = translations[lang].title;
  document.getElementById("weatherDesc").innerText = translations[lang].desc;
  document.getElementById("locationInput").placeholder = translations[lang].placeholder;
  document.getElementById("getWeatherBtn").innerText = translations[lang].getWeather;
  document.getElementById("backBtn").innerText = translations[lang].back;
}

// Validate if input is a location, not weather condition
function isValidLocation(input) {
  const weatherTerms = ['rain', 'sunny', 'cloudy', 'snow', 'storm', 'thunder', 'wind', 'hot', 'cold', 'warm', 'cool', 'clear', 'overcast', 'drizzle', 'fog', 'mist'];
  const inputLower = input.toLowerCase().trim();
  
  // Check if input is just a weather term
  if (weatherTerms.includes(inputLower)) {
    return false;
  }
  
  // Check if input contains only weather terms
  const words = inputLower.split(' ');
  const isOnlyWeatherTerms = words.every(word => weatherTerms.includes(word));
  
  return !isOnlyWeatherTerms;
}

// Enhanced location autocomplete functionality
async function handleLocationInput() {
  const input = document.getElementById("locationInput").value.trim();
  const dropdown = document.getElementById("autocompleteDropdown");

  // Clear previous timeout
  if (autocompleteTimeout) {
    clearTimeout(autocompleteTimeout);
  }

  if (input.length < 2) {
    dropdown.style.display = "none";
    return;
  }

  // Debounce the search
  autocompleteTimeout = setTimeout(async () => {
    try {
      // First, search in our local database
      const localResults = worldCities.filter(city => 
        city.name.toLowerCase().includes(input.toLowerCase()) || 
        city.country.toLowerCase().includes(input.toLowerCase()) ||
        (city.state && city.state.toLowerCase().includes(input.toLowerCase()))
      ).slice(0, 5);

      if (localResults.length > 0) {
        showAutocompleteResults(localResults);
      } else {
        // If no local results, try geocoding API
        try {
          const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(input)}&limit=5&addressdetails=1`);
          const data = await response.json();
          
          if (data && data.length > 0) {
            const apiResults = data.map(item => ({
              name: item.name || item.display_name.split(',')[0],
              country: item.address?.country || '',
              state: item.address?.state || '',
              lat: parseFloat(item.lat),
              lon: parseFloat(item.lon),
              display_name: item.display_name
            }));
            showAutocompleteResults(apiResults);
          } else {
            dropdown.style.display = "none";
          }
        } catch (error) {
          console.log('Geocoding API failed, showing local results only');
          dropdown.style.display = "none";
        }
      }
    } catch (error) {
      console.error('Autocomplete error:', error);
      dropdown.style.display = "none";
    }
  }, 300);
}

function showAutocompleteResults(results) {
  const dropdown = document.getElementById("autocompleteDropdown");
  dropdown.innerHTML = "";

  results.forEach(location => {
    const item = document.createElement("div");
    item.className = "autocomplete-item";
    
    let displayText = location.name;
    if (location.state) displayText += `, ${location.state}`;
    if (location.country) displayText += `, ${location.country}`;
    
    item.textContent = displayText;
    item.onclick = () => selectLocation(location);
    dropdown.appendChild(item);
  });

  dropdown.style.display = "block";
}

function selectLocation(location) {
  selectedLocationData = location;
  let displayName = location.name;
  if (location.state) displayName += `, ${location.state}`;
  if (location.country) displayName += `, ${location.country}`;
  
  document.getElementById("locationInput").value = displayName;
  document.getElementById("autocompleteDropdown").style.display = "none";
}

function handleKeyDown(event) {
  if (event.key === "Enter") {
    getWeather();
  }
}

// Hide dropdown when clicking outside
document.addEventListener("click", function(event) {
  const dropdown = document.getElementById("autocompleteDropdown");
  const input = document.getElementById("locationInput");
  
  if (!dropdown.contains(event.target) && event.target !== input) {
    dropdown.style.display = "none";
  }
});

// Only create particles initially - no animation
function createStaticParticles() {
  const particlesContainer = document.getElementById('particles');
  particlesContainer.innerHTML = '';
  
  for (let i = 0; i < 30; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.left = Math.random() * 100 + '%';
    particle.style.top = Math.random() * 100 + '%';
    particle.style.animationDelay = Math.random() * 15 + 's';
    particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
    particle.style.width = particle.style.height = Math.random() * 4 + 2 + 'px';
    particle.style.opacity = '0.3';
    particlesContainer.appendChild(particle);
  }
}

// Create animated particles when weather is fetched
function createWeatherParticles() {
  const particlesContainer = document.getElementById('particles');
  particlesContainer.innerHTML = '';
  
  for (let i = 0; i < 50; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.left = Math.random() * 100 + '%';
    particle.style.animationDelay = Math.random() * 15 + 's';
    particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
    particle.style.width = particle.style.height = Math.random() * 6 + 2 + 'px';
    particlesContainer.appendChild(particle);
  }
}

function getWeatherIcon(condition) {
  const conditionLower = condition.toLowerCase();
  if (conditionLower.includes('sun') || conditionLower.includes('clear')) return '‚òÄÔ∏è';
  if (conditionLower.includes('cloud')) return '‚òÅÔ∏è';
  if (conditionLower.includes('rain') || conditionLower.includes('drizzle')) return 'üåßÔ∏è';
  if (conditionLower.includes('snow')) return '‚ùÑÔ∏è';
  if (conditionLower.includes('thunder') || conditionLower.includes('storm')) return '‚õàÔ∏è';
  if (conditionLower.includes('mist') || conditionLower.includes('fog')) return 'üå´Ô∏è';
  return 'üå§Ô∏è';
}

function setBackgroundByWeather(condition) {
  const body = document.body;
  body.className = ''; // Remove all classes
  
  const conditionLower = condition.toLowerCase();
  if (conditionLower.includes('sun') || conditionLower.includes('clear')) {
    body.classList.add('sunny');
  } else if (conditionLower.includes('cloud')) {
    body.classList.add('cloudy');
  } else if (conditionLower.includes('rain') || conditionLower.includes('drizzle')) {
    body.classList.add('rainy');
  } else if (conditionLower.includes('snow')) {
    body.classList.add('snowy');
  } else if (conditionLower.includes('thunder') || conditionLower.includes('storm')) {
    body.classList.add('stormy');
  } else if (conditionLower.includes('mist') || conditionLower.includes('fog')) {
    body.classList.add('misty');
  } else {
    body.classList.add('default');
  }
  
  // Create animated particles when weather background changes
  createWeatherParticles();
}

// Weather fetching function with real API
async function getWeather() {
  const input = document.getElementById("locationInput").value.trim();
  const lang = document.getElementById("languageSelect").value;
  const resultDiv = document.getElementById("weatherResult");

  if (!input) {
    resultDiv.innerHTML = `<span style='color:red;'>${translations[lang].error}</span>`;
    return;
  }

  // Validate if input is a location
  if (!isValidLocation(input)) {
    resultDiv.innerHTML = `<div class="error-note">${translations[lang].invalidLocation}</div>`;
    return;
  }

  resultDiv.innerHTML = `<span>${translations[lang].result(input)} <div class="loading"></div></span>`;

  try {
    let locationName, country, state, lat, lon;

    // Use selected location data if available
    if (selectedLocationData) {
      locationName = selectedLocationData.name;
      country = selectedLocationData.country;
      state = selectedLocationData.state;
      lat = selectedLocationData.lat;
      lon = selectedLocationData.lon;
    } else {
      // Find location in our database
      const city = worldCities.find(city => 
        city.name.toLowerCase().includes(input.toLowerCase()) ||
        input.toLowerCase().includes(city.name.toLowerCase())
      );

      if (city) {
        locationName = city.name;
        country = city.country;
        state = city.state;
        lat = city.lat;
        lon = city.lon;
      } else {
        // Try geocoding for unknown locations
        try {
          const geoResponse = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(input)}&limit=1&addressdetails=1`);
          const geoData = await geoResponse.json();
          
          if (geoData && geoData.length > 0) {
            const location = geoData[0];
            locationName = location.name || location.display_name.split(',')[0];
            country = location.address?.country || '';
            state = location.address?.state || '';
            lat = parseFloat(location.lat);
            lon = parseFloat(location.lon);
          } else {
            throw new Error('Location not found');
          }
        } catch (error) {
          resultDiv.innerHTML = `<span style='color:red;'>${translations[lang].error}</span>`;
          return;
        }
      }
    }

    // Try to get real weather data using OpenWeatherMap API
    let weatherData;
    try {
      // You can replace this with your actual API key
      const apiKey = "demo_key"; // This won't work, but structure is correct
      const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`);
      
      if (response.ok) {
        const data = await response.json();
        weatherData = {
          temp: Math.round(data.main.temp),
          feelsLike: Math.round(data.main.feels_like),
          humidity: data.main.humidity,
          wind: Math.round(data.wind.speed * 3.6), // Convert m/s to km/h
          windDirection: data.wind.deg || 0,
          condition: data.weather[0].description,
          isReal: true
        };
      } else {
        throw new Error('API failed');
      }
    } catch (error) {
      // Fallback to realistic simulation based on actual geographic and seasonal data
      weatherData = generateAccurateWeather(locationName, lat, lon);
      weatherData.isReal = false;
    }

    const icon = getWeatherIcon(weatherData.condition);
    
    // Set dynamic background based on weather
    setBackgroundByWeather(weatherData.condition);

    let displayLocation = locationName;
    if (state) displayLocation += `, ${state}`;
    if (country) displayLocation += `, ${country}`;

    resultDiv.innerHTML = `
      <div class="weather-card">
        <h3>üåç ${displayLocation}</h3>
        <div class="weather-icon">${icon}</div>
        <div class="temperature">${weatherData.temp}¬∞C</div>
        <p><b>${weatherData.condition}</b></p>
        <div class="weather-details">
          <div class="detail-item">
            <strong>üå°Ô∏è Feels Like</strong><br>
            ${weatherData.feelsLike}¬∞C
          </div>
          <div class="detail-item">
            <strong>üíß Humidity</strong><br>
            ${weatherData.humidity}%
          </div>
          <div class="detail-item">
            <strong>üå¨Ô∏è Wind Speed</strong><br>
            ${weatherData.wind} km/h
          </div>
          <div class="detail-item">
            <strong>üß≠ Wind Direction</strong><br>
            ${weatherData.windDirection}¬∞
          </div>
        </div>
        <div class="${weatherData.isReal ? 'api-note' : 'error-note'}">
          ${weatherData.isReal ? 
            '‚úÖ Real-time weather data from OpenWeatherMap API' : 
            'üîÑ Simulated weather data based on geographic location and current season (API demo mode)'
          }
        </div>
      </div>
    `;

    // Reset selected location data
    selectedLocationData = null;
    
  } catch (error) {
    console.error('Weather Error:', error);
    resultDiv.innerHTML = `<span style='color:red;'>${translations[lang].error}</span>`;
  }
}

// Generate more accurate weather based on actual geographic and seasonal patterns
function generateAccurateWeather(locationName, lat, lon) {
  const now = new Date();
  const month = now.getMonth(); // 0-11
  const hour = now.getHours();

  // Determine season based on latitude and month
  let season;
  if (lat >= 0) { // Northern hemisphere
    if (month >= 11 || month <= 1) season = 'winter';
    else if (month >= 2 && month <= 4) season = 'spring';
    else if (month >= 5 && month <= 7) season = 'summer';
    else season = 'autumn';
  } else { // Southern hemisphere
    if (month >= 5 && month <= 7) season = 'winter';
    else if (month >= 8 && month <= 10) season = 'spring';
    else if (month >= 11 || month <= 1) season = 'summer';
    else season = 'autumn';
  }

  // Climate zones based on latitude
  let climateZone;
  const absLat = Math.abs(lat);
  if (absLat < 23.5) climateZone = 'tropical';
  else if (absLat < 35) climateZone = 'subtropical';
  else if (absLat < 60) climateZone = 'temperate';
  else climateZone = 'polar';

  // Base temperature by climate zone and season
  const tempRanges = {
    tropical: { winter: [22, 28], spring: [24, 30], summer: [26, 32], autumn: [24, 30] },
    subtropical: { winter: [8, 18], spring: [15, 25], summer: [20, 35], autumn: [15, 25] },
    temperate: { winter: [-5, 10], spring: [5, 20], summer: [15, 30], autumn: [5, 20] },
    polar: { winter: [-25, -5], spring: [-10, 5], summer: [0, 15], autumn: [-10, 5] }
  };

  const [minTemp, maxTemp] = tempRanges[climateZone][season];
  const temp = Math.round(minTemp + Math.random() * (maxTemp - minTemp));

  // Weather conditions by climate and season
  const weatherPatterns = {
    tropical: {
      winter: ['Partly cloudy', 'Sunny', 'Light rain'],
      spring: ['Sunny', 'Partly cloudy', 'Thunderstorm'],
      summer: ['Thunderstorm', 'Heavy rain', 'Partly cloudy'],
      autumn: ['Light rain', 'Partly cloudy', 'Sunny']
    },
    subtropical: {
      winter: ['Clear sky', 'Partly cloudy', 'Light rain'],
      spring: ['Sunny', 'Partly cloudy', 'Light rain'],
      summer: ['Sunny', 'Hot', 'Partly cloudy'],
      autumn: ['Clear sky', 'Partly cloudy', 'Light rain']
    },
    temperate: {
      winter: ['Cloudy', 'Light rain', 'Snow'],
      spring: ['Partly cloudy', 'Light rain', 'Sunny'],
      summer: ['Sunny', 'Partly cloudy', 'Thunderstorm'],
      autumn: ['Cloudy', 'Light rain', 'Partly cloudy']
    },
    polar: {
      winter: ['Snow', 'Cloudy', 'Clear sky'],
      spring: ['Cloudy', 'Light rain', 'Clear sky'],
      summer: ['Partly cloudy', 'Light rain', 'Clear sky'],
      autumn: ['Cloudy', 'Light rain', 'Snow']
    }
  };

  const conditions = weatherPatterns[climateZone][season];
  const condition = conditions[Math.floor(Math.random() * conditions.length)];

  const feelsLike = temp + Math.round(Math.random() * 6 - 3);
  const humidity = Math.round(40 + Math.random() * 40); // 40-80%
  const wind = Math.round(5 + Math.random() * 20); // 5-25 km/h
  const windDirection = Math.round(Math.random() * 360);

  return { temp, feelsLike, humidity, wind, windDirection, condition };
}

// Initialize with static particles on page load
document.addEventListener("DOMContentLoaded", function() {
  createStaticParticles();
  setLanguage();
});
</script>
</body>
</html>